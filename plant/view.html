<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <link rel="icon" href="../favicon.png">
  <link rel="stylesheet" type="text/css" href="/../css/view.css">
  <script src="js/dendrogram.js"></script>
</head>

<body>
  <div id="content-container">
</div>
<div id="left-page-container">
  <img src="img/argemone.jpg" id="plant-picture"/>
  <h1 id="common-name"> Oregano </h1>
  <h2 id="scientific-name"> Origanum Vulgare </h2>
</div>

<div id="right-page-container">
<h2> DESCRIPTION </h2>
<p id="plant-description"> Oregano (scientific name Origanum vulgare) is a common species of Origanum, a genus of the mint family (Lamiaceae). It is native to temperate western and southwestern Eurasia and the Mediterranean region.
Oregano is a perennial herb, growing from 20–80 cm (7.9–31.5 in) tall, with opposite leaves 1–4 cm (0.39–1.57 in) long. Oregano will grow in a pH range between 6.0 (mildly acidic) and 9.0 (strongly alkaline),
 with a preferred range between 6.0 and 8.0. The flowers are purple, 3–4 mm (0.12–0.16 in) long, produced in erect spikes. It is sometimes called wild marjoram, and its close relative O. majorana is known as sweet marjoram.
</p>
<h2 id="taxonomy"> TAXONOMY</h2>
<div id="dendrogram-container"> </div>
<h2>Search </h2>
<div id="search-box">
<input placeholder="search for a plant by scientific name" type="text"></input>
<p> E.g: Spartium, Lavandula, Mentha.
</div>
</div>
<script src="https://d3js.org/d3.v3.min.js"></script>
<script>

/* Parsing CSV */
var csvData;
var plantID;
var plantName;
var plantImg;
var plantDescription ;

// taxonomy variables
var plantOrder;
var plantFamily;
var plantGenus;
var plantSpecies;
// all plant Names for search
var plantNames = [];

function drawFromCSV(plantIndex) {
  d3.csv("plantOutput.csv", function(error, rows) {
    console.log('parsing csv');
    csvData = rows;
    plantID = csvData[plantIndex].id;
    plantName = csvData[plantIndex].name;
    plantImg = csvData[plantIndex].image;
    plantDescription = csvData[plantIndex].paragraph;

    // taxonomy variables
    plantOrder = csvData[plantIndex].order;
    plantFamily = csvData[plantIndex].family;
    plantGenus = csvData[plantIndex].genus;
    plantSpecies = csvData[plantIndex].species;
    commonName = document.getElementById('common-name');
    commonName.innerHTML = plantName;
    var scientificName = document.getElementById('scientific-name');
    scientificName.innerHTML = plantSpecies;
    var plantPicture = document.getElementById('plant-picture');
    plantPicture.setAttribute("src", plantImg);
    var plantParagraph = document.getElementById('plant-description');
    plantParagraph.innerHTML = plantDescription.replace(/(<([^>]+)>)/ig,"");
    console.log("test" + plantParagraph.innerHTML);
    // create a list of all plantNames
      for (i = 0; i < csvData.length; i++) {
        plantNames.push(csvData[i].name);
      }


    drawDendrogram(plantOrder, plantFamily, plantGenus, plantSpecies);
    /* replace the old dendro with the new one.
      places the svg into #dendrogram-container div */
    function appendDendro() {
      var dendroContainer = document.getElementById('dendrogram-container')
      var viz = document.getElementsByTagName('svg')[0];
      dendroContainer.appendChild(viz);
    }
    appendDendro();


  });
}
drawFromCSV(341)


// the plant within csvdata which data should be pulled for
var plantIndex = 341;
var searchvalue = document.getElementsByTagName("input").value;
var search = document.body.getElementsByTagName('input')[0];
var searchitems = document.body.getElementsByClassName('search-item');
function plantMatch(plant) {
  return plant.toLowerCase().includes(search.value.toLowerCase())
}
/* Delete the .search-item div's */
function deleteBoxes() {
  while(searchitems[0]) {
    console.log('deleting search boxes')
    var tempsearch = document.getElementById('search-box');
  tempsearch.removeChild(searchitems[0]);
  }
}

function removeOldDendro() {
  var dendroContainer = document.getElementById('dendrogram-container')
  var oldSVG = document.getElementsByTagName('svg')[0];
    dendroContainer.removeChild(oldSVG);
}

/* Search Bar Key Event :: Autocomplete */
search.addEventListener("keydown", function(event) {
  if (event.keyCode === 8 || event.keyCode === 46) {
    deleteBoxes();
  }
  if (search.value.length === 1) {
    deleteBoxes()
  }
  if (search.value.length >= 2) {
    /* while there are search-item boxes, delete the first one */
    deleteBoxes()
  var plantscopy = plantNames;
  var plantMatches = plantscopy.filter(plantMatch);
  // console.log(plantMatches)
    for(i=0; i < plantMatches.length; i++) {
      var searchitem = document.createElement('div');
      var searchbox = document.getElementById('search-box');

      plantIndex = plantMatches[i]
      searchbox.appendChild(searchitem);
      searchitem.setAttribute('class', 'search-item')
      searchitem.innerHTML = plantMatches[i];
      searchitem.onclick=function() {
        removeOldDendro();
        drawFromCSV(plantNames.indexOf(plantIndex.toString()));
        deleteBoxes();
        var input = document.getElementsByTagName('input')[0];
        input.value = "";
      }
    }
  }
}, 1000)









/* generating page data from CSV
id,name,order,family,genus,species,image,paragraph  */
</script>
